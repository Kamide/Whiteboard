{% extends 'classes.html' %}

{% from 'macros.html' import print_user with context %}

{% block title %}{{ current_class }} - {{ super() }}{% endblock %}

{% block style %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='users.css') }}">
{% endblock %}

{% block content %}
    <section>
        <header><h2>{{ current_class }}</h2></header>
        {{ print_class_info(current_class) }}
        <section>
            <header><h3>Students</h3></header>
            {% if current_user.is_teacher %}
                <section class="card">
                    <header><h4>Registration</h4></header>
                    <form class="inlined" action="" method="post">
                        <div>
                            {{ get_csrf_token() }}
                            {{ form.student.label }}
                            {{ form.student }}
                        </div>
                        <div>
                            <input type="submit" name="action" value="Enroll Student">
                            <input type="submit" name="action" value="Withdraw Student">
                        </div>
                    </form>
                </section>
            {% endif %}
            {% if students.count() > 0 %}
                <ul class="users-list">
                    {% for student in students %}
                        {% if current_class.teacher.user == current_user %}
                            {% call print_user(student.user) %}
                                <form class="inlined" action="{{ url_for('admin.mark_attendance', class_id=current_class.id) }}" method="post">
                                    {{ get_csrf_token() }}
                                    <input type="submit" name="action" value="Mark Present">
                                </form>
                            {% endcall %}
                        {% else %}
                            {{ print_user(student.user) }}
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p class="emphasized"><em>No students enrolled.</em></p>
            {% endif %}
        </section>
    </section>
{% endblock %}
