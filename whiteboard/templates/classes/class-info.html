{% extends 'classes.html' %}

{% from 'macros.html' import print_user with context %}

{% block title %}{{ current_class }} - {{ super() }}{% endblock %}

{% block style %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='users.css') }}">
{% endblock %}

{% block content %}
    <section>
        <header><h2>{{ current_class }}</h2></header>
        {{ print_class_info(current_class) }}
        <section>
            <header><h3>Students</h3></header>
            {% block subcontent %}
                {% call action_links('h4', current_user.is_teacher) %}
                    {{ nav_link(url_for('classes.enrollment', class_id=current_class.id), 'Show Enrollment Panel') }}
                {% endcall %}
            {% endblock %}
            {% if students.count() > 0 %}
                <ul class="users-list">
                    {% for student in students %}
                        {% if current_class.teacher.user == current_user and today %}
                            {% call print_user(student.user) %}
                                <form class="inlined" method="post">
                                    {{ get_csrf_token() }}
                                    {% if student.present(current_class.id, today) %}
                                        <input type="submit" name="action" value="Mark Absent" formaction="{{ url_for('classes.mark_absent', class_id=current_class.id, student_id=student.user_id) }}">
                                    {% else %}
                                        <input type="submit" name="action" value="Mark Present" formaction="{{ url_for('classes.mark_present', class_id=current_class.id, student_id=student.user_id) }}">
                                    {% endif %}
                                </form>
                            {% endcall %}
                        {% else %}
                            {{ print_user(student.user) }}
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p class="emphasized"><em>No students enrolled.</em></p>
            {% endif %}
        </section>
    </section>
{% endblock %}
